<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8" />
        <title>maptalks.heat demo</title>
        <script src="https://unpkg.com/jquery@<3.3.1/dist/jquery.min.js"></script>
        <script src="https://unpkg.com/maptalks@1.0.0-alpha.9/dist/maptalks.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/@maptalks/gl/dist/maptalksgl.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/@maptalks/vt/dist/maptalks.vt.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/@maptalks/gltf-layer/dist/maptalks.gltf.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/@maptalks/vt.basic/dist/maptalks.vt.basic.js"></script>

        <script src="../dist/maptalks.routeplayer.js"></script>
        <link
            type="text/css"
            rel="stylesheet"
            href="https://unpkg.com/maptalks@<2.0.0/dist/maptalks.css"
        />
        <script src="route.js"></script>
        <style>
            html,
            body {
                margin: 0px;
                height: 100%;
                width: 100%;
            }
            #map {
                width: 90%;
                height: 100%;
                float: left;
            }
            #control {
                width: 10%;
                height: 100%;
                float: right;
            }
            a {
                color: #0077ff;
            }
        </style>
    </head>
    <body>
        <div id="map"></div>
        <div id="control">
            <a href="javascript:play();">Play</a><br />
            <a href="javascript:pause();">Pause</a><br />
            <a href="javascript:cancel();">Cancel</a><br />
            <a href="javascript:finish();">Finish</a><br />
            <a href="javascript:speed(0.5);">0.5X</a><br />
            <a href="javascript:speed(1);">1X</a><br />
            <a href="javascript:speed(2);">2X</a><br />
            <a href="javascript:speed(4);">4X</a><br />
            <span id="info">current info: </span>
        </div>
        <script>
            var map = new maptalks.Map("map", {
                center: [121.505, 31.2611],
                zoom: 15,
                attributionControl: {
                    content:
                        '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, &copy; <a href="https://carto.com/attributions">CARTO</a>'
                },
                baseLayer: new maptalks.TileLayer("base", {
                    urlTemplate:
                        'http://{s}.basemaps.cartocdn.com/dark_nolabels/{z}/{x}/{y}.png',
                    subdomains: ['a', 'b', 'c', 'd', 'e']
                })
            });
            var count = 0;
            var testRoutes = [];
            map.on('click', e => {
                if (count < 20) {
                    testRoutes.push([e.coordinate.x, e.coordinate.y, 9721000 + count * 200000, { info: '111'}]);
                } else {
                    console.log(testRoutes);
                }
                count++;
            });

            var player = new maptalks.RoutePlayer(route1, map, {
                markerSymbol: {
                    url: 'gltf/moto/moto.gltf',
                    scale: [1, 1, 1],
                    rotation: [90, 0, 90]
                }
            });
            var unitTime = player.getUnitTime();
            player.on("playing", function(param) {
                if (
                    player.getCurrentProperties(0) !== undefined &&
                    player.getCurrentProperties(0) !== null
                ) {
                    $("#info").text(
                        "current info: " + player.getCurrentProperties(0).info
                    );
                }
            });

            player.play();

            function play() {
                player.play();
            }

            function pause() {
                player.pause();
            }

            function finish() {
                player.finish();
            }

            function cancel() {
                player.cancel();
            }

            function speed(t) {
                player.setUnitTime(unitTime * t);
            }
        </script>
    </body>
</html>
